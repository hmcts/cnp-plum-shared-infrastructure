#!groovy
//noinspection GroovyUnusedAssignment
@Library("Infrastructure@deployment-target-spike") _

properties([
    parameters([
        booleanParam(name: 'PLAN_ONLY', defaultValue: false, description: 'set to true for skipping terraform apply')
    ])
])

import uk.gov.hmcts.contino.Environment

planOnly = params.PLAN_ONLY
deploymentTarget = 'v2'
Environment environment = new Environment(env)

onMaster {
  sharedInfrastructurePipeline('rhubarb', environment.nonProdName, 'nonprod', planOnly,deploymentTarget)
  sharedInfrastructurePipeline('rhubarb', environment.demoName, 'nonprod', planOnly,deploymentTarget)
  sharedInfrastructurePipeline('rhubarb', environment.prodName, 'prod', planOnly,deploymentTarget)
}

onPR {
  //sharedInfrastructurePipeline('rhubarb', environment.previewName, 'nonprod', planOnly,deploymentTarget)
  sharedInfrastructurePipeline('rhubarb', environment.nonProdName, 'nonprod', planOnly,deploymentTarget)
}